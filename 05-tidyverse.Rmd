# tidyverse 통합 패키지


## tidyverse 이해
+ Hadley Wickham이 개발한 데이터 과학을 위한 R 패키지의 집합체(collection)
+ 모든 패키지는 공통적이고 일관된 설계 철학, 문법, 데이터 구조를 공유함
+ 정돈된 세계(tidy + universe)를 구성하여 작업을 직관적이고 일관성있게 수행하도록 도와줌
+ tidy API의 4가지 원칙
  + 기존 자료구조의 재사용(reuse existing data structures)
  + 파이프 연산자를 이용한 단순한 함수 조합(compose simple function with pipe)
  + 함수형 프로그래밍을 적극 포용(embrace functional programming)
  + 사람을 위한 설계(design for humans)

|패키지|설명|
|:---:|:------------|
|tibble|tidyverse에서 사용하는 R 데이터 객체 제공|
|readr|tibble 객체로 외부 파일을 불러오거나 저장하는 함수 제공|
|dplyr|데이터 가공, 탐색적 자료분석 등을 위한 함수 제공|
|tidyr|타이디 데이터(tidy data)를 구현하는 함수 제공|
|stringr|문자열(string)을 다루는 함수 제공|
|forcats|팩터(factor)를 다루는 함수 제공|
|lubridate, hms|날짜, 시간을 다루는 함수 제공|
|purrr|함수형 프로그래밍 도구 제공|
|ggplot2|데이터 시각화를 위한 함수 제공|


<br>

![](./img/fig5-1.png)


----------------------------------------------------------------------


## tidyverse 작업 흐름
+ tidyverse 통합 패키지는 다음과 같은 데이터 분석 프로젝트의 작업 흐름을 지원하도록 설계됨

![](./img/fig5-2.png)


----------------------------------------------------------------------


## 타이디 데이터(tidy data)
+ tidyverse에서 사용되는 데이터 표준 저장 형태로, 분석에 용이하고 깔끔한(tidy) 데이터
+ 타이디 데이터의 3가지 규칙
  1. 모든 열은 변수이다(Every column is variable).
  2. 모든 행은 관측값이다(Every row is an observation).
  3. 모든 셀은 단일 값을 가진다(Every cell is a single value).

![](./img/fig5-4.png)


----------------------------------------------------------------------



## 파이프(pipe) 연산자
+ ```%>%``` - 다중 연산을 하나의 순차적인 연산의 결합으로 표현하는 강력한 도구
+ 단축키 ```ctrl``` + ```shift``` + ```m```
+ 데이터 연산의 흐름을 좌에서 우로 변경(기존 방식은 안에서 밖임)
  + 왼쪽 표현식(left-hand side expression)의 결과를 오른쪽 표현식(right-hand side expression)으로 전달함
  + 이때, lhs은 rhs의 첫번째 매개변수로 사용됨
  + lhs가 사용될 위치를 지정하기 위해서는 rhs에서 place-holder ```.```를 사용해야 함
+ 연산 작업 중 어느 위치에서나 쉽게 단계를 추가할 수 있음
+ 복잡한 코드를 단순화시켜 가독성 크게 향상시킴
+ 2014년 개발된 magrittr 패키지에 포함되어 있음
+ 2021년 R version 4.1.0부터는 기본 파이프 연산자 ```|>``` 새롭게 추가됨

```{r eval = FALSE}
# 데이터프레임 x에 f(), g(), h() 함수를 순차적으로 적용
# 일반적인 경우: 함수를 중첩해서 사용
h(g(f(x)))

# 파이프 연산자를 사용하는 경우: 연쇄적인 연산의 결합으로 표현
x %>% 
  f() %>% 
  g() %>% 
  h()
```


```{r eval = FALSE}
iris %>% head
iris %>% head(10)
"World" %>% cat("Hello,", .)
```


----------------------------------------------------------------------


## tibble 패키지
### tibble object
+ tidyverse에서 사용하는 R 데이터 객체
+ 좀 더 편리하게 사용할 수 있도록 수정된 특수한 종류의 데이터프레임으로, 데이터프레임과 근본적으로 큰 차이는 없음
+ 데이터를 출력할 때 콘솔 창이 넘어가지 않도록 설계되어 있음
  + ```str()``` 함수 기능을 가져와 각 변수(열)의 유형을 변수명과 함께 표시
  + 처음 10개의 행과 한 화면에 들어갈 수 있는 열만 표시
  + 전체 데이터셋을 보기 위해서는 ```View()``` 함수 사용
+ 입력 유형(input's type)이 변하지 않음
+ 변수명을 수정할 수 없으며, 행 이름과 산술연산을 지원하지 않음


|변수 라벨|설명|
|:---:|:------------|
|\<chr\>|문자형(character)|
|\<int\>|정수형(integer)|
|\<dbl\>|실수형(double)|
|\<date\>|날짜(date)|
|\<time\>|시간(time)|
|\<dttm\>|날짜와 시간(date-time)|
|\<lgl\>|논리형(logical)|
|+lbl|변수의 값에 부여된 라벨 값이 추가되어 있음을 표시|


<br>

```{r eval = FALSE}
library(nycflights13)
flights
fligths %>% View()
```


### tibble 이해
+ 새로운 tibble 생성 - ```tibble()``` 함수
  + 길이가 1인 입력은 자동으로 재사용함
  + 변수명 지정이 훨씬 유연함 - ``` `` ```(backticks) 사용
  
```{r}
library(tibble)

mytbl <- tibble(
  x = 1:5, 
  y = 1, 
  z = x ^ 2 + y
)

mytbl
```


<br>

+ 데이터프레임을 tibble로 변환 - ```as_tibble()``` 함수
+ tibble을 데이터프레임으로 변환 - ```as.data.frame()``` 함수

```{r eval = FALSE}
as_tibble(iris)
as.data.frame(flights)
```


<br>

+ 부분집합(subset)에 엄격하며, ```[]```은 항상 tibble을 반환함
+ 하나의 열만 추출하려면 ```[[]]``` 또는 ```$```을 사용

```{r eval = FALSE}
df <- data.frame(x = 1:3, y = 3:1)
class(df[, 1:2])                    # "data.frame"
class(df[, 1])                      # "integer"

tbl <- tibble(x = 1:3, y = 3:1)
class(tbl[, 1:2])                    # "tbl_df"  "tbl"  "data.frame"
class(tbl[, 1])                      # "tbl_df"  "tbl"  "data.frame"

class(tbl[[1]])                      # "integer"
class(tbl$x)                         # "integer"
```


----------------------------------------------------------------------


## readr 패키지


### readr 패키지 소개
+ **tibble 객체**로 외부 파일을 불러오거나 저장하는 함수를 제공하는 패키지

|함수|설명|
|:---:|:------------|
|read_csv()|쉼표로 구분된 파일 불러오기
|read_tsv()|탭으로 구분된 파일 불러오기
|read_delim()|임의의 구분자로 구분된 파일 불러오기
|read_table()|공백으로 구분된 파일 불러오기
|read_spss()|spss 데이터 파일 불러오기
|read_sas()|sas 데이터 파일 불러오기(haven 패키지)


### read_csv() 함수
+ ```read.csv()``` 함수에 비해 약 10배 정도 빠르며, 좀 더 재현성이 뛰어남
+ 첫번째 줄은 변수명(header)으로 사용
+ 매개변수 ```col_names``` - 변수명(header)이 없는 경우 사용
  + ```col_names = FALSE``` - 변수명을 X1부터 Xn까지 순차적으로 붙여줌
  + ```col_names = c("x", "y", "z")```와 같이 변수명으로 사용할 문자형 벡터를 입력 가능
+ 매개변수 ```skip``` - 파일의 첫 n줄 생략
+ 매개변수 ```na``` - 특정값을 결측값으로 지정
+ 예제 - [StudentSurvey.csv](./dataset/StudentSurvey.csv)

```{r eval = FALSE}
library(readr)
data <- read_csv("StudentSurvey.csv")
data
```

